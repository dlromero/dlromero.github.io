@model SoftBottin.Models.Shoes.cShoe
@{
    ViewBag.Title = "Crear Zapato";
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<SelectListItem> lsShoesTypes = ViewBag.lsShoesTypes;
    List<SelectListItem> lsColors = ViewBag.lsColors;
}
<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.14.0/jquery.validate.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/mvc/5.2.3/jquery.validate.unobtrusive.min.js"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/css/bootstrap-select.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/js/bootstrap-select.min.js"></script>



<section class="app-tipos-zapatos">

    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <h2>Crear Zapato</h2>
                @using (Html.BeginForm("CrearZapato", "Shoes", FormMethod.Post, new { onsubmit = "return preSave();" }))
                {
                    @Html.ValidationSummary(true)
                    <div class="form-group">
                        <label for="name">Nombre</label>
                        @Html.TextBoxFor(dina => dina.sName,
                                         new
                                         {
                                             @class = "form-control",
                                             id = "name",
                                             placeholder = "Ingrese Nombre",
                                             maxlength = "100"
                                         })
                        @Html.ValidationMessageFor(model => model.sName)
                        <p class="help-block">Ingrese el nombre del zapato.</p>
                    </div>
                    <div class="form-group">
                        <label for="description">Descripción</label>
                        @Html.TextBoxFor(dina => dina.sDescription,
                                         new
                                         {
                                             @class = "form-control",
                                             id = "description",
                                             placeholder = "Ingrese Descripción",
                                             maxlength = "100"
                                         })
                        @Html.ValidationMessageFor(model => model.sDescription)
                        <p class="help-block">Ingrese la descrpción del zapato.</p>
                    </div>
                    <div class="form-group">
                        <label for="ref">Referencia</label>
                        @Html.TextBoxFor(dina => dina.sRef,
                                         new
                                         {
                                             @class = "form-control",
                                             id = "ref",
                                             placeholder = "Ingrese Referencia",
                                             maxlength = "100"
                                         })
                        @Html.ValidationMessageFor(model => model.sRef)

                        <p class="help-block">Ingrese la referencia del zapato.</p>
                    </div>
                    <div class="form-group">
                        <label for="iCost">Costo</label>
                        @Html.TextBoxFor(dina => dina.iCost,
                                         new
                                         {
                                             @class = "form-control",
                                             id = "iCost",
                                             placeholder = "Ingrese Costos",
                                             maxlength = "100"
                                         })
                        @Html.ValidationMessageFor(model => model.iCost)

                        <p class="help-block">Ingrese el costo.</p>
                    </div>
                    <div class="form-group">
                        <label for="iPrice">Precio</label>
                        @Html.TextBoxFor(dina => dina.iPrice,
                                         new
                                         {
                                             @class = "form-control",
                                             id = "iPrice",
                                             placeholder = "Ingrese Precio",
                                             maxlength = "100"
                                         })
                        @Html.ValidationMessageFor(model => model.iPrice)

                        <p class="help-block">Ingrese el precio.</p>
                    </div>

                    <div class="form-group">
                        <label for="lsShoesTypes">Tipo de zapato</label>
                        @Html.DropDownListFor(mdl => mdl.iShoeType, lsShoesTypes.OrderBy(rsl => rsl.Text), "Tipo de Zapato", new { @class = "form-control", id = "lsShoesTypes" })
                        <p class="help-block">Seleccione un tipo de zapato.</p>
                    </div>

                    <div class="app-base-colores-final">
                        <div class="panel panel-default panel-primary">
                            <div class="panel-heading ">
                                Agregar un color de zapato
                            </div>
                            <div class="panel-body">
                                <div class="form-group">
                                    <label for="lsColors">Seleccione un color</label>
                                    @Html.DropDownListFor(mdl => mdl.iColor, lsColors.OrderBy(rsl => rsl.Text), "Color", new { @class = "form-control", id = "lsColors" })
                                    @Html.ValidationMessageFor(model => model.iColor)

                                    <p class="help-block">Seleccione un color.</p>
                                </div>

                                <div class="form-group">
                                    <label for="ref">Seleccione las fotos</label>
                                    <div class="row">
                                        <div class="col-sm-6 col-md-4">
                                            <div class="thumbnail">
                                                @Html.Partial("Imagenes", 1)
                                                <h3>Foto frontal</h3>
                                            </div>
                                        </div>
                                        <div class="col-sm-6 col-md-4">
                                            <div class="thumbnail">
                                                @Html.Partial("Imagenes", 2)
                                                <h3>Foto lateral</h3>
                                            </div>
                                        </div>
                                        <div class="col-sm-6 col-md-4">
                                            <div class="thumbnail">
                                                @Html.Partial("Imagenes", 3)
                                                <h3>Foto trasera</h3>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="help-block">Seleccione las fotos.</p>
                                </div>

                                <div class="form-group">
                                    <label for="lsSize">Seleccione las tallas</label>

                                    <select class="selectpicker form-control app-tallas" multiple data-selected-text-format="count > 3" id="lsSize">
                                        <option>34</option>
                                        <option>35</option>
                                        <option>36</option>
                                        <option>37</option>
                                        <option>38</option>
                                        <option>39</option>
                                    </select>

                                    @Html.ValidationMessageFor(model => model.sRef)

                                    <p class="help-block">Seleccione las tallas.</p>
                                </div>
                                <div id="Sizes" class="Sizes">
                                </div>
                            </div>
                            <div class="panel-footer">
                                @*<button type="button" class="btn btn-default" onclick="addColor()">+ Agregar otro color</button>*@
                            </div>

                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <div class="alert alert-danger" style="display:none" role="alert" id="altError">
                                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                                <strong>Bienvenido!</strong> accediste con éxito.
                            </div>
                        </div>
                    </div>

                    <div class="container">

                        <div class="-xs-12 col-sm-12 col-md-6 col-lg-6">
                            <button type="submit" class="btn btn-success btn-block">Guardar</button>
                        </div>
                        <div class="-xs-12 col-sm-12 col-md-6 col-lg-6">
                            @Html.ActionLink("Cancelar", "Zapatos", "Shoes", new { }, new { @class = "btn btn-danger btn-block" })
                        </div>
                        @Html.HiddenFor(mdl => mdl.sColorDetail, new { @id = "sColorDetail" })
                    </div>


                    <script type="text/javascript">

                        var arrObjColors = [];

                        function preSave() {



                            if ($("#input-1").fileinput().data().fileinput.ajaxRequests.length == 0) {
                                var result = '<a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>' +
                                           '<strong>Cuidado!</strong> Es necesario que suba la foto frontal.';
                                $("#altError").html(result);
                                $("#altError").show();
                                return false;
                            } else
                                if ($("#input-2").fileinput().data().fileinput.ajaxRequests.length == 0) {
                                    var result = '<a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>' +
                                           '<strong>Cuidado!</strong> Es necesario que suba la foto lateral.';
                                    $("#altError").html(result);
                                    $("#altError").show();
                                    return false;
                                } else
                                    if ($("#input-3").fileinput().data().fileinput.ajaxRequests.length == 0) {
                                        var result = '<a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>' +
                                           '<strong>Cuidado!</strong> Es necesario que suba la foto trasera.';
                                        $("#altError").html(result);
                                        $("#altError").show();
                                        return false;
                                    } else {
                                        $("#altError").hide();
                                    }

                            if ($("#lsSize").val() == null || $("#lsSize").val() == "") {
                                var result = '<a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>' +
                                             '<strong>Cuidado!</strong> Es necesario que selecciones al menos 1 talla.';
                                $("#altError").html(result);
                                $("#altError").show();
                                return false;
                            } else {
                                $("#altError").hide();
                            }


                            if ($("#lsColors").val() == null || $("#lsColors").val() == "") {
                                var result = '<a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>' +
                                             '<strong>Cuidado!</strong> Es necesario que selecciones un color.';
                                $("#altError").html(result);
                                $("#altError").show();
                                return false;
                            } else {
                                $("#altError").hide();
                            }



                            var childrenInput = $("#Sizes").children('*').children(".panel-body").children(".form-group").children("input");
                            var valueSelect = $("#lsSize").val();




                            jQuery.each(childrenInput, function (i, val) {
                                var myObject = {
                                    'iIdColor': $("#lsColors").val(),
                                    'iSize': valueSelect[i],
                                    'iQuantity': val.value,
                                    'iQuantityExisting': val.value,
                                    'iQuantitySold': 0
                                };
                                arrObjColors.push(myObject);
                            });

                            $("#sColorDetail").val(JSON.stringify(arrObjColors));

                            return true;
                        }

                        $("#lsSize").change(function () {

                            $("#Sizes").html("");
                            var htmlFinal = "";

                            var valueSelect = $("#lsSize").val();

                            $.each(valueSelect, function (index, value) {
                                htmlFinal = htmlFinal +
                                        '<div class="panel panel-default panel-info">' +
                                        '<div class="panel-heading ">' +
                                        'Cantidad existente para la talla: <span class="badge">' + value + '</span>' +
                                        '</div>' +
                                        '<div class="panel-body">' +
                                        '<div class="form-group">' +
                                        '<label for="Quantity-' + index + '">Ingrese la cantidad existente por talla</label>' +
                                        '<input class="form-control" id="Quantity-' + index + '" maxlength="100" name="Quantity-' + index + '" placeholder="Ingrese Cantidad" type="text" value="" required>' +
                                         '<p class="help-block">Ingrese la cantidad existente por talla.</p>' +
                                         '</div>' +
                                         '</div>' +
                                        '</div>';
                            });


                            $("#Sizes").append(htmlFinal);
                        });

                    </script>

                }
            </div>
        </div>
    </div>

</section>
